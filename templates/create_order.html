<!DOCTYPE html>
<html>
<head>
    <title>Create Order | PixelStore</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        pixel: ['"Press Start 2P"', 'cursive'],
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-white font-sans">
    <header class="border-b-4 border-purple-600 bg-gray-800 py-4">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-pixel text-purple-400">Pixel<span class="text-green-400">Store</span></h1>
                <nav class="hidden md:flex space-x-1">
                    <a href="/" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Home</a>
                    <a href="/upload-file" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Upload</a>
                    <a href="/images" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Gallery</a>
                    <a href="/create-order" class="px-3 py-2 text-white bg-purple-700 rounded-md transition">Orders</a>
                </nav>
                <button class="md:hidden text-purple-300 hover:text-white">
                    <svg xmlns="[http://www.w3.org/2000/svg"](http://www.w3.org/2000/svg") class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </header>
    
    <div class="md:hidden bg-gray-800 pb-3">
        <nav class="flex flex-col px-4">
            <a href="/" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Home</a>
            <a href="/upload-file" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Upload</a>
            <a href="/images" class="px-3 py-2 text-purple-300 hover:text-white hover:bg-purple-700 rounded-md transition">Gallery</a>
            <a href="/create-order" class="px-3 py-2 text-white bg-purple-700 rounded-md transition">Orders</a>
        </nav>
    </div>
    
    <main class="py-12">
        <div class="container mx-auto px-4">
            <div class="max-w-2xl mx-auto">
                <h1 class="text-2xl md:text-3xl font-pixel mb-8 text-center text-green-400">Create New Order</h1>
                
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages() %}
                  {% if messages %}
                    <div class="bg-red-600 text-white p-4 mb-6 rounded-md border-2 border-red-400">
                      <ul>
                        {% for message in messages %}
                          <li class="font-pixel text-sm">{{ message }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                {% endwith %}
                
                <div class="bg-gray-800 p-6 md:p-8 rounded-lg border-2 border-green-500">
                    <form method="post" enctype="multipart/form-data" class="space-y-6">
                        <div>
                            <label for="product_id" class="block text-sm font-medium text-gray-300 mb-2">Select Product</label>
                            <select id="product_id" name="product_id" required
                                   class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">-- Select a product --</option>
                                {% for product in products %}
                                    <option value="{{ product.product_id }}" 
                                            data-stock="{{ product.stock_count }}"
                                            data-name="{{ product.product_name }}"
                                            data-image-url="{{ product.image_url }}">
                                        {{ product.product_name }} (Stock: {{ product.stock_count }})
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div>
                            <label for="order_quantity" class="block text-sm font-medium text-gray-300 mb-2">Order Quantity</label>
                            <input type="number" id="order_quantity" name="order_quantity" min="1" value="1" required
                                   class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <p id="stock-warning" class="text-red-400 text-sm mt-2 hidden font-pixel">Warning: Order quantity exceeds available stock!</p>
                        </div>
                        
                        <!-- Product Preview Section -->
                        <div id="product-preview" class="mt-6 hidden">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Product Preview</label>
                            <div class="border-2 border-purple-500 rounded-md p-4 bg-gray-700">
                                <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
                                    <div class="w-full md:w-1/2">
                                        <img id="product-image" src="" alt="Product Image" class="w-full h-48 object-cover rounded-md bg-gray-600">
                                    </div>
                                    <div class="w-full md:w-1/2 space-y-2">
                                        <h3 id="product-name" class="text-lg font-pixel text-green-400"></h3>
                                        <p class="text-sm text-gray-300">Stock: <span id="product-stock" class="font-pixel"></span></p>
                                        <p class="text-sm text-gray-300">Order Quantity: <span id="display-quantity" class="font-pixel text-purple-400">1</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="no-product-selected" class="mt-6">
                            <div class="border-2 border-gray-600 rounded-md p-4 bg-gray-700 text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                <p class="mt-2 text-gray-400 font-pixel text-sm">No product selected yet</p>
                                <p class="mt-1 text-gray-500 text-xs">Select a product to see preview</p>
                            </div>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-purple-600 rounded-md font-medium text-white hover:from-green-500 hover:to-purple-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 focus:ring-offset-gray-800 transition">
                                Create Order
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="bg-gray-800 border-t-4 border-purple-600 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 mb-4 md:mb-0">&copy; 2025 PixelStore. All rights reserved.</p>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-purple-400 transition">Privacy</a>
                    <a href="#" class="text-gray-400 hover:text-purple-400 transition">Terms</a>
                    <a href="#" class="text-gray-400 hover:text-purple-400 transition">Contact</a>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // Mobile menu toggle
        document.querySelector('button').addEventListener('click', function() {
            const nav = document.querySelector('.md\\:hidden nav');
            nav.classList.toggle('hidden');
        });
        
        // Add client-side validation for stock
        document.getElementById('order_quantity').addEventListener('input', checkStock);
        document.getElementById('product_id').addEventListener('change', updateProductPreview);
        
        function checkStock() {
            const quantityInput = document.getElementById('order_quantity');
            const productSelect = document.getElementById('product_id');
            const warningElement = document.getElementById('stock-warning');
            const displayQuantity = document.getElementById('display-quantity');
            
            // Update the display quantity
            if (displayQuantity) {
                displayQuantity.textContent = quantityInput.value;
            }
            
            if (productSelect.selectedIndex > 0) {
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                const availableStock = parseInt(selectedOption.dataset.stock);
                const orderQuantity = parseInt(quantityInput.value);
                
                if (orderQuantity > availableStock) {
                    warningElement.classList.remove('hidden');
                } else {
                    warningElement.classList.add('hidden');
                }
            }
        }
        
        function updateProductPreview() {
            const productSelect = document.getElementById('product_id');
            const productPreview = document.getElementById('product-preview');
            const noProductSelected = document.getElementById('no-product-selected');
            const productImage = document.getElementById('product-image');
            const productName = document.getElementById('product-name');
            const productStock = document.getElementById('product-stock');
            
            if (productSelect.selectedIndex > 0) {
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                
                // Update product details
                productName.textContent = selectedOption.dataset.name;
                productStock.textContent = selectedOption.dataset.stock;
                
                // Set the image URL directly from the data attribute
                const imageUrl = selectedOption.dataset.imageUrl;
                if (imageUrl && imageUrl.trim() !== '') {
                    productImage.src = imageUrl;
                } else {
                    // Use a fallback image if no image URL is available
                    productImage.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2FhYSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIj48L3JlY3Q+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9IjIxIDE1IDE2IDEwIDUgMTUiPjwvcG9seWxpbmU+PC9zdmc+';
                }
                
                // Handle image loading errors
                productImage.onerror = function() {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2FhYSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIj48L3JlY3Q+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9IjIxIDE1IDE2IDEwIDUgMTUiPjwvcG9seWxpbmU+PC9zdmc+';
                    this.onerror = null; // Prevent infinite loop
                };
                
                // Show product preview, hide "no product selected" message
                productPreview.classList.remove('hidden');
                noProductSelected.classList.add('hidden');
                
                // Update the quantity display
                checkStock();
            } else {
                // Hide product preview, show "no product selected" message
                productPreview.classList.add('hidden');
                noProductSelected.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
